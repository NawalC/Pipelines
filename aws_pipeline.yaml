trigger:
  batch: true
  branches:
    include:
    - main
  paths:
    include:
    - AWS_Pipeline
variables:
- group: terraform-config
stages:
- stage: plan
  jobs:
  - job: Deploy
    continueOnError: false
    pool:
      vmImage: 'ubuntu-latest'  
    steps:
    - task: TerraformInstaller@0
      displayName: 'Terraform Install'
      terraformVersion: 'latest'
      downloadUrl: 'https://releases.hashicorp.com/terraform/1.2.5/'
    - task: TerraformTaskV3@3
      displayName: 'Terraform Initialise'
      inputs:
        provider: 'aws'
        command: 'init'
        backendServiceAWS: 'pipeline'
        backendAWSBucketName: 'tf-training-state-file-14072022'
        backendAWSKey: 'main'
    - task: TerraformTaskV3@3
      displayName: 'Terraform Validate'
      inputs:
        provider: 'aws'
        command: 'validate'        